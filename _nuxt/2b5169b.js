(window.webpackJsonp=window.webpackJsonp||[]).push([[99,42],{1107:function(e,t,r){"use strict";r(980)},1108:function(e,t,r){var n=r(17)(!1);n.push([e.i,".search[data-v-be58c618] input{padding:0!important}.search[data-v-be58c618] .v-text-field.v-text-field--enclosed:not(.v-text-field--rounded)>.v-input__control>.v-input__slot{padding:.4rem .4rem .4rem .8rem!important;min-height:0!important;border:1px solid transparent!important;transition:all .2s ease-in-out!important}.search[data-v-be58c618] .v-input--is-focused.v-text-field.v-text-field--enclosed:not(.v-text-field--rounded)>.v-input__control>.v-input__slot{background-color:transparent!important;border:1px solid #2f4986!important}.avatar_border[data-v-be58c618]{border:2px solid #57a257}.chat .chat_message[data-v-be58c618]{text-overflow:ellipsis;overflow:hidden;display:-webkit-box!important;-webkit-line-clamp:1;-webkit-box-orient:vertical}.border[data-v-be58c618]{border:1px solid hsla(0,0%,43.9%,.14118)}",""]),e.exports=n},1223:function(e,t,r){"use strict";r.r(t);var n=r(302),c=r(192),o=r(306),l=r(143),d=r(811),h=r(251),f=r(303),v=r(193),_=r(29),m=r(305),y=r(300),x=r(810),w=r(882),C=(r(27),r(335),r(20),r(28)),k=(r(88),r(6),r(8),r(21),r(30),r(41),r(907)),j=r(338),D=r(267),O={meta:{title:"chat"},layout:"dashboard",components:{VEmojiPicker:k.a},data:function(){return{yesterday:new Date((new Date).setDate((new Date).getDate()-1)),message:null,search:null,maxMsgChars:150,messages:null,receiver:null,chatUsersData:null,chat:null,chatUsersIds:[]}},methods:{selectEmoji:function(e){this.message?this.message+=e.data:this.message=e.data},chatHandler:function(e){console.log("chatHandler(item) says: item = ",e),this.receiver=this.getObjByPropVal(this.chatUsersData,"id",e.advertise_id),this.getMsg()},getObjByPropVal:function(e,t,r){if(e&&!(e.length<1)){var n=null;return e.forEach((function(e){String(e[t])===String(r)&&(n=e)})),n}},sendMsg:function(){var e=this;return Object(C.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(j.i)(Object(j.c)(D.a,"chat","".concat(e.$auth.user.id,"-").concat(e.receiver.id)),{last_message:e.message,last_author:e.$auth.user.full_name,created_at:(new Date).getTime(),client_id:e.$auth.user.id,advertise_id:e.receiver.id});case 3:return t.next=5,Object(j.i)(Object(j.c)(D.a,"chat","".concat(e.receiver.id,"-").concat(e.$auth.user.id)),{last_message:e.message,last_author:e.$auth.user.full_name,created_at:(new Date).getTime(),client_id:e.receiver.id,advertise_id:e.$auth.user.id});case 5:return t.next=7,Object(j.a)(Object(j.b)(D.a,"chat","".concat(e.$auth.user.id,"-").concat(e.receiver.id),"messages"),{message:e.message,author:e.$auth.user.full_name,created_at:(new Date).getTime(),client_id:e.$auth.user.id,advertise_id:e.receiver.id});case 7:return t.next=9,Object(j.a)(Object(j.b)(D.a,"chat","".concat(e.receiver.id,"-").concat(e.$auth.user.id),"messages"),{message:e.message,author:e.$auth.user.full_name,created_at:(new Date).getTime(),client_id:e.$auth.user.id,advertise_id:e.receiver.id});case 9:e.message=null,t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error adding document: ",t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()},getMsg:function(){var e=this;if(console.log("getMsg says: this.receiver = ",this.receiver),this.receiver){console.log("getMsg says: this.$auth.user = ",this.$auth.user),console.log("getMsg says: this.$auth.user.id = ",this.$auth.user.id);var t=Object(j.h)(Object(j.b)(D.a,"chat","".concat(this.$auth.user.id,"-").concat(this.receiver.id),"messages"),Object(j.g)("created_at"));console.log("getMsg(): says qObj = ",t),Object(j.f)(t,(function(t){var r={};t.forEach((function(e){console.log("Current data: ",e.data()),r[(new Date).toLocaleDateString()]||(r[(new Date).toLocaleDateString()]=[]),r[(new Date).toLocaleDateString()].push(e.data())})),e.messages=r}),(function(e){console.error("onSnapshot error: ",e)}))}},getChat:function(){var e=this;console.log("getChat() says: this.$auth.user.id = ",this.$auth.user.id);var t=Object(j.h)(Object(j.b)(D.a,"chat"),Object(j.j)("client_id","==",this.$auth.user.id));Object(j.f)(t,(function(t){var r=[],n=[];t.forEach((function(e){console.log("getChat() says: chat data = ",e.data()),n.push(e.data().advertise_id),r.push(e.data())})),e.chat=r,n.forEach((function(t){e.chatUsersIds.includes(t)||(console.log("there is a new id is added ! which = ",t),e.chatUsersIds.push(t),e.fetchChatUsers())})),e.receiver||null===e.chat||(console.log("!this.receiver"+!e.receiver+" && this.chat !== null "+e.chat!="null ->",!e.receiver&&null!==e.chat),console.warn("getChat says-> this.chat = ",e.chat),e.receiver=e.getObjByPropVal(e.chatUsersData,"id",e.chat[0].advertise_id),e.fetchDefaultUser(e.chat),console.warn("this.chat",e.chat)),console.log("getChat() says: allChat data = ",r)}),(function(e){console.error("onSnapshot error: ",e)}))},fetchChatUsers:function(){var e=this;return Object(C.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("fetchChatUsers() callback and this.chatUsersIds = ",e.chatUsersIds),console.log("fetchChatUsers() callback and this.chatUsersIds.length = ",e.chatUsersIds.length),e.chatUsersIds){t.next=4;break}return t.abrupt("return");case 4:if(0!==e.chatUsersIds.length){t.next=6;break}return t.abrupt("return");case 6:return t.prev=6,t.next=9,e.$axios.get("auth/get_users",{params:{users:e.chatUsersIds}});case 9:r=t.sent,e.chatUsersData=r.data.object,console.log("fetchChatUsers() says: response = ",r),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(6),e.errors=e.catchException(t.t0);case 17:case"end":return t.stop()}}),t,null,[[6,14]])})))()},fetchDefaultUser:function(e){var t=this;return Object(C.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,console.warn("fetchDefaultUser() says: this.chat = ",t.chat),console.warn("fetchDefaultUser() says: chatArg = ",e),r.next=5,Object(j.d)(Object(j.b)(D.a,"chat","".concat(e.client_id,"-").concat(e.advertise_id),"messages"));case 5:r.sent.forEach((function(e){console.warn(e.id," => ",e.data())})),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(0),t.errors=t.catchException(r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,9]])})))()}},watch:{chatUsersIds:function(e,t){console.log("chatUsersIds watcher triggered and newVal = ",e),console.log("chatUsersIds watcher triggered and oldVal = ",t)}},mounted:function(){this.getChat(),this.fetchDefaultUser(this.chat)}},S=(r(1107),r(44)),component=Object(S.a)(O,(function(){var e=this,t=e._self._c;return t(x.a,{staticClass:"chat"},[t(d.a,{attrs:{cols:"12"}},[t("h1",{staticClass:"fs-24 font-weight-medium primary-text"},[e._v("Messages")])]),e._v(" "),t(d.a,{attrs:{cols:"12",md:"5"}},[t(o.a,{staticClass:"pa-3",attrs:{outlined:"",elevation:"1"}},[t(l.d,{staticClass:"text-h4 grey--text text--darken-4 pa-0 px-4"},[e._v("All messages")]),e._v(" "),t("text-field",{staticClass:"fix-icon search mb-2 d-block px-2",attrs:{value:e.search,type:"text",rules:{required:!1},"sub-label":"search",solo:"",backgroundColor:"rgba(0, 0, 0, 0.06)",placeholder:"Search",outlined:!1},on:{"update:value":function(t){e.search=t}},scopedSlots:e._u([{key:"appendInner",fn:function(){return[t(c.a,{attrs:{color:"secondary",fab:"",small:"",depressed:""}},[t(h.a,{attrs:{"x-small":""}},[e._v("\n                            fal fa-search\n                        ")])],1)]},proxy:!0}])}),e._v(" "),t(f.a,{staticClass:"overflow-y-auto",attrs:{height:"475"}},[t(m.a,{staticClass:"pl-2 overflow-y-hidden",attrs:{color:"primary",mandatory:""}},e._l(e.chat,(function(r,i){return t(v.a,{key:i,staticClass:"border mb-2 rounded",attrs:{outlined:""},on:{click:function(t){return e.chatHandler(r)}}},[t(_.a,{staticClass:"py-2"},[t("div",{staticClass:"chat-block w-100"},[t(n.a,{staticClass:"me-2 avatar_border",attrs:{size:"50",color:"#57A257"}},[e.getObjByPropVal(e.chatUsersData,"id",r.advertise_id)?t("img",{attrs:{src:e.getObjByPropVal(e.chatUsersData,"id",r.advertise_id).image_url,alt:"John"}}):e._e()]),e._v(" "),t("div",{staticClass:"flex-grow-1"},[t("div",{staticClass:"d-flex justify-space-between"},[e.getObjByPropVal(e.chatUsersData,"id",r.advertise_id)?t("span",{staticClass:"text-caption grey--text text--darken-4",domProps:{innerHTML:e._s(e.getObjByPropVal(e.chatUsersData,"id",r.advertise_id).full_name)}}):e._e(),e._v(" "),t("span",{staticClass:"text-caption"},[e._v("\n                                            "+e._s(new Date(Number(r.created_at)).toLocaleDateString())+"\n                                            ")])]),e._v(" "),t("div",{staticClass:"text-caption grey--text text--darken-4"},[e._v("\n                                        Last seen 10AM\n                                    ")]),e._v(" "),t("div",{staticClass:"text-body-2 chat_message grey--text"},[e._v(e._s(r.last_message))])])],1)])],1)})),1)],1)],1)],1),e._v(" "),t(d.a,{attrs:{cols:"12",md:"7"}},[t(o.a,{attrs:{outlined:""}},[t("div",{staticClass:"chat-header pa-2"},[t("div",{staticClass:"d-flex align-center"},[e.receiver?t(n.a,{staticClass:"me-3",attrs:{size:"50"}},[t("img",{attrs:{src:e.receiver.image_url,alt:"John"}})]):t(w.a,{attrs:{type:"avatar",size:"50"}}),e._v(" "),e.receiver?t("div",[t("h2",{staticClass:"text-body-1 grey--text text--darken-4"},[e._v("\n                            "+e._s(e.receiver.full_name)+"\n                        ")]),e._v(" "),t("p",{staticClass:"text-caption grey--text text--darken-2"},[e._v("\n                            Last seen 18hr ago\n                        ")])]):t("div",[e._v("\n                        You don't have messages right now\n                    ")])],1),e._v(" "),t(c.a,{attrs:{icon:"","x-large":""}},[t(h.a,[e._v("\n                        fas fa-ellipsis\n                    ")])],1)],1),e._v(" "),e._l(e.messages,(function(r,c,l){return t(o.a,{key:"dayIndex-".concat(l),staticClass:"pt-4 px-3",attrs:{height:"475"}},[c===new Date(e.yesterday).toLocaleDateString()?t("p",{staticClass:"text-center text-caption"},[e._v("\n                    Yesterday at "+e._s(new Date(r[0].created_at).toLocaleString("en-us",{hour:"numeric",minute:"numeric"})))]):c===(new Date).toLocaleDateString()?t("p",{staticClass:"text-center text-caption"},[e._v("Today at\n                    "+e._s(new Date(r[0].created_at).toLocaleString("en-us",{hour:"numeric",minute:"numeric"}))+"\n                ")]):t("p",{staticClass:"text-center text-caption"},[e._v(e._s(c))]),e._v(" "),r?e._l(r,(function(c,o){return t("div",{key:"msgIndex-".concat(o),staticClass:"chat-box pb-1 d-flex align-center",class:{receiver:e.$auth.user.id===c.client_id,sender:e.$auth.user.id!==c.client_id}},[e.$auth.user.id===c.client_id?[o>0?[r[o-1].client_id!==r[o].client_id?t(n.a,{staticClass:"ml-3 order-3",attrs:{size:"35"}},[t("img",{attrs:{src:e.$auth.user.image_url,alt:"John"}})]):e._e()]:[t(n.a,{staticClass:"ml-3 order-3",attrs:{size:"35"}},[t("img",{attrs:{src:e.$auth.user.image_url,alt:"John"}})])]]:[o>0?[r[o-1].client_id!==r[o].client_id?t(n.a,{staticClass:"mr-3 order-1",attrs:{size:"35"}},[e.getObjByPropVal(e.chatUsersData,"id",c.client_id)?t("img",{attrs:{src:e.getObjByPropVal(e.chatUsersData,"id",c.client_id).image_url,alt:"John"}}):e._e()]):e._e()]:[t(n.a,{staticClass:"mr-3 order-1",attrs:{size:"35"}},[e.getObjByPropVal(e.chatUsersData,"id",c.client_id)?t("img",{attrs:{src:e.getObjByPropVal(e.chatUsersData,"id",c.client_id).image_url,alt:"John"}}):e._e()])]],e._v(" "),o<1?t("p",{staticClass:"message text-body-2 py-2 px-4 order-2"},[e._v("\n                            "+e._s(c.message)+"\n                        ")]):e.$auth.user.id===c.client_id?t("p",{staticClass:"message text-body-2 py-2 px-4 order-2",class:{"mr-12":r[o-1].client_id===r[o].client_id}},[e._v("\n                            "+e._s(c.message)+"\n                        ")]):t("p",{staticClass:"message text-body-2 py-2 px-4 order-2",class:{"ml-12":r[o-1].client_id===r[o].client_id}},[e._v("\n                            "+e._s(c.message)+"\n                        ")])],2)})):e._e()],2)})),e._v(" "),t("div",{staticClass:"chat-field pa-4"},[t("text-field",{staticClass:"search",attrs:{value:e.message,"hide-details":"",clearable:"","sub-label":"Message",solo:"",type:"text",backgroundColor:"rgba(0, 0, 0, 0.06)",placeholder:"Write your message...",outlined:!1},on:{"update:value":function(t){e.message=t},enterClicked:e.sendMsg},scopedSlots:e._u([{key:"prependInner",fn:function(){return[t(c.a,{attrs:{icon:""}},[t(h.a,[e._v("fa-light fa-image")])],1)]},proxy:!0},{key:"appendInner",fn:function(){return[t(y.a,{attrs:{"close-on-content-click":!1,absolute:""},scopedSlots:e._u([{key:"activator",fn:function(r){var n=r.on,o=r.attrs;return[t(c.a,e._g(e._b({attrs:{icon:""},on:{click:function(e){e.stopPropagation()}}},"v-btn",o,!1),n),[t(h.a,{attrs:{color:"grey"}},[e._v("\n                                        fal fa-laugh\n                                    ")])],1)]}}])},[e._v(" "),t(f.a,{staticClass:"pa-0"},[t("VEmojiPicker",{on:{select:e.selectEmoji}})],1)],1),e._v(" "),t(c.a,{attrs:{color:"secondary",fab:"",small:"",depressed:""}},[t(h.a,{attrs:{small:""}},[e._v("\n                                fal fa-paper-plane\n                            ")])],1)]},proxy:!0}])})],1)],2)],1)],1)}),[],!1,null,"be58c618",null);t.default=component.exports;installComponents(component,{TextField:r(824).default})},824:function(e,t,r){"use strict";r.r(t);var n=r(100),c=(r(25),r(20),{props:{rules:{type:[Object],default:function(){return{}}},inputClass:{type:[String],default:""},topLabel:{type:[String],default:null},type:{type:[String],default:""},name:{type:[String],default:""},value:{type:[String,Array,Number,Boolean],default:null},suffix:{type:[String],default:""},prefix:{type:[String],default:""},filled:{type:[Boolean],default:!1},outlined:{type:[Boolean],default:!0},disabled:{type:[Boolean],default:!1},solo:{type:[Boolean],default:!1},appendIcon:{type:[String],default:""},backgroundColor:{type:[String],default:""},subLabel:{type:[String],default:""},supLabel:{type:[String],default:""},placeholder:{type:[String],default:""},label:{type:[String],default:""},isLoading:{type:[Boolean],default:!1},prependInnerIcon:{type:[String],default:""},vInputClass:{type:[String],default:""},errors:null},data:function(){return{initiatedAsPassword:!1,isReadOnly:!0}},computed:{isTypePassword:function(){return"password"===this.type},inputRules:function(){return this.disabled&&this.rules&&(this.rules.required=!1),this.rules},computedAppendIcon:function(){return this.initiatedAsPassword?("password"===this.type&&(e="fal fa-eye input-password"),"text"===this.type&&this.initiatedAsPassword&&(e="fal fa-eye-slash input-password"),e):this.appendIcon;var e}},created:function(){"password"===this.type&&(this.initiatedAsPassword=!0)},methods:{getRequiredStar:function(e){return this[e]&&this.rules&&this.rules.required?"".concat(this.$t(this[e])," *"):this.$t(this[e])},input:function(e){if("number"===this.type&&e)return this.$emit("update:value",parseInt(e));this.$emit("update:value",e),this.$emit("inputHandler",e)},enterClicked:function(){this.$emit("enterClicked")},click:function(){this.isTypePassword?(this.initiatedAsPassword=!0,this.$emit("update:type","text")):this.initiatedAsPassword&&this.$emit("update:type","password")}}}),o=r(44),component=Object(o.a)(c,(function(){var e=this,t=e._self._c;return t("ValidationProvider",{class:e.inputClass,attrs:{rules:e.rules,name:e.name},scopedSlots:e._u([{key:"default",fn:function(r){var c=r.errors;return[e.topLabel?t("label",{staticClass:"d-flex justify-space-between align-end mb-1 position-relative",staticStyle:{"font-size":"13px",color:"#ababab","font-weight":"500"}},[e._v("\n        "+e._s(e.getRequiredStar("topLabel"))+"\n\n    "),e._t("labelInner")],2):e._e(),e._v(" "),t(n.a,{staticClass:"mytexty-field",class:e.vInputClass,attrs:{value:e.value,"background-color":e.backgroundColor,readonly:!!e.isTypePassword&&e.isReadOnly,prefix:e.getRequiredStar("prefix"),suffix:e.$t(e.suffix),disabled:e.disabled,"append-icon":e.computedAppendIcon,"prepend-inner-icon":e.prependInnerIcon,"error-messages":c,"hide-details":"auto",dense:"",type:e.type,outlined:e.outlined,filled:e.filled,solo:e.solo,flat:"",placeholder:e.$t(e.placeholder),loading:e.isLoading},on:{"click:append":e.click,input:e.input,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.enterClicked.apply(null,arguments)},focus:function(t){e.isReadOnly=!1}},scopedSlots:e._u([{key:"append",fn:function(){return[e._t("appendInner")]},proxy:!0},{key:"prepend-inner",fn:function(){return[e._t("prependInner")]},proxy:!0}],null,!0)})]}}],null,!0)})}),[],!1,null,"28abe298",null);t.default=component.exports},980:function(e,t,r){var content=r(1108);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(18).default)("a6fbfc08",content,!0,{sourceMap:!1})}}]);