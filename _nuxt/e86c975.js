(window.webpackJsonp=window.webpackJsonp||[]).push([[75,42],{1076:function(t,e,r){"use strict";r(968)},1077:function(t,e,r){var n=r(17)(!1);n.push([t.i,".search[data-v-6e5e3469] input{padding:0!important}.search[data-v-6e5e3469] .v-text-field.v-text-field--enclosed:not(.v-text-field--rounded)>.v-input__control>.v-input__slot{padding:.4rem .4rem .4rem .8rem!important;min-height:0!important;border:1px solid transparent!important;transition:all .2s ease-in-out!important}.search[data-v-6e5e3469] .v-input--is-focused.v-text-field.v-text-field--enclosed:not(.v-text-field--rounded)>.v-input__control>.v-input__slot{background-color:transparent!important;border:1px solid #2f4986!important}.avatar_border[data-v-6e5e3469]{border:2px solid #57a257}.chat .chat_message[data-v-6e5e3469]{position:absolute;left:0;bottom:0}.border[data-v-6e5e3469]{border:1px solid hsla(0,0%,43.9%,.14118)}",""]),t.exports=n},1205:function(t,e,r){"use strict";r.r(e);var n=r(302),l=r(192),o=r(306),d=r(143),c=r(811),h=r(251),f=r(254),y=r(303),v=r(193),m=r(29),_=r(305),x=r(810),C=(r(20),r(6),r(8),r(21),r(30),r(41),r(338)),w=r(267),S={meta:{title:"messages"},layout:"dashboard",data:function(){return{message:null,search:null,maxMsgChars:150,messages:null,chatUsersData:null,chat:null,visibleChat:null,chatUsersIds:[],firstUserData:null,searchValue:null}},methods:{getObjByPropVal:function(t,e,r){if(!t)return null;if(t.length<1)return null;var n=null;return t.forEach((function(t){String(t[e])===String(r)&&(n=t)})),n},getChat:function(){var t=this,e=Object(C.h)(Object(C.b)(w.a,"client_chats"),Object(C.j)("client_id","==",String(this.$auth.user.id)));Object(C.f)(e,(function(e){var r=[],n=[];e.forEach((function(t){n.push(t.data().advertise_id),r.push(t.data())})),t.chat=r,t.visibleChat=r,t.chatUsersIds=n,t.fetchChatUsers(t.chatUsersIds)}),(function(t){console.error("onSnapshot error: ",t)}))},fetchChatUsers:function(t){var e=this;t&&0!==t.length&&this.$axios.get("auth/get_users",{params:{users:t}}).then((function(r){return e.chatUsersData=r.data.object,e.$route.params.id||e.getFirstMsg(e.getObjByPropVal(r.data.object,"id",t[0])),r})).catch((function(t){return e.errors=e.catchException(t)}))},getFirstMsg:function(t){var e=this;if(t){var r=Object(C.h)(Object(C.b)(w.a,"client_chats","".concat(this.$auth.user.id,"-").concat(t.id),"messages"),Object(C.g)("date"));Object(C.f)(r,(function(r){var n={};r.forEach((function(t){n[new Date(Number(t.data().date)).toLocaleDateString()]||(n[new Date(Number(t.data().date)).toLocaleDateString()]=[]),n[new Date(Number(t.data().date)).toLocaleDateString()].push(t.data())})),e.firstUserData={allMessages:n,data:t}}),(function(t){console.error("onSnapshot error: ",t)}))}},searchHandler:function(){var t=this;this.visibleChat=[],this.chat.forEach((function(e){t.getObjByPropVal(t.chatUsersData,"id",e.advertise_id)&&t.getObjByPropVal(t.chatUsersData,"id",e.advertise_id).full_name.toUpperCase().includes(t.searchValue.toUpperCase())&&t.visibleChat.push(e)}))}},created:function(){this.getChat()},watch:{$route:function(t,e){t.params.id||(console.warn("messages.vue watcer says: this.chatUsersData = ",this.chatUsersData),console.warn("messages.vue watcer says: this.chatUserIds ",this.chatUserIds),this.getFirstMsg(this.getObjByPropVal(this.chatUsersData,"id",this.chatUsersIds[0])))}}},k=(r(1076),r(44)),component=Object(k.a)(S,(function(){var t=this,e=t._self._c;return e(x.a,{staticClass:"chat"},[e(c.a,{attrs:{cols:"12"}},[e("h1",{staticClass:"fs-24 font-weight-medium primary-text"},[t._v("Messages")])]),t._v(" "),e(c.a,{attrs:{cols:"12",md:"5"}},[e(o.a,{staticClass:"pa-3",attrs:{outlined:"",elevation:"1"}},[e(d.d,{staticClass:"text-h4 grey--text text--darken-4 pa-0 px-4"},[t._v("All messages")]),t._v(" "),e("text-field",{staticClass:"fix-icon search mb-2 d-block px-2",attrs:{value:t.searchValue,type:"text",rules:{required:!1},"sub-label":"search",solo:"",backgroundColor:"rgba(0, 0, 0, 0.06)",placeholder:"Search",outlined:!1},on:{"update:value":function(e){t.searchValue=e},inputHandler:t.searchHandler},scopedSlots:t._u([{key:"appendInner",fn:function(){return[e(l.a,{attrs:{color:"secondary",fab:"",small:"",depressed:""},on:{click:t.searchHandler}},[e(h.a,{attrs:{"x-small":""}},[t._v("\n                            fal fa-search\n                        ")])],1)]},proxy:!0}])}),t._v(" "),e(y.a,{staticClass:"overflow-y-auto",attrs:{height:"499"}},[e(_.a,{staticClass:"px-2 overflow-y-hidden",attrs:{color:"primary",mandatory:""}},t._l(t.visibleChat,(function(r,i){return e(v.a,{key:i,staticClass:"border mb-2 rounded",attrs:{outlined:"",to:{name:"student-messages-id",params:{id:r.advertise_id}},nuxt:""}},[e(m.a,{staticClass:"py-2"},[e("div",{staticClass:"chat-block w-100"},[e(n.a,{staticClass:"me-2 avatar_border",attrs:{size:"50",color:"#57A257"}},[t.getObjByPropVal(t.chatUsersData,"id",r.advertise_id)?e("img",{attrs:{src:t.getObjByPropVal(t.chatUsersData,"id",r.advertise_id).image_url,alt:"John"}}):t._e()]),t._v(" "),e("div",{staticClass:"flex-grow-1 position-relative pb-5"},[e("div",{staticClass:"d-flex justify-space-between"},[t.getObjByPropVal(t.chatUsersData,"id",r.advertise_id)?e("span",{staticClass:"text-caption grey--text text--darken-4",domProps:{innerHTML:t._s(t.getObjByPropVal(t.chatUsersData,"id",r.advertise_id).full_name)}}):t._e(),t._v(" "),e("span",{staticClass:"text-caption"},[t._v("\n                                            "+t._s(new Date(Number(r.last_message_date)).toLocaleDateString())+"\n                                            ")])]),t._v(" "),e("div",{staticClass:"text-caption grey--text text--darken-4"},[t._v("\n                                        Last seen 10AM\n                                    ")]),t._v(" "),e("div",{staticClass:"text-body-2 chat_message grey--text"},["image"===r.type?[e(f.a,{attrs:{width:"20",height:"20",src:r.last_message_content}})]:[t._v("\n                                            "+t._s(r.last_message_content)+"\n                                        ")]],2)])],1)])],1)})),1)],1)],1)],1),t._v(" "),e(c.a,{attrs:{cols:"12",md:"7"}},[e("nuxt-child",{attrs:{usersIds:t.chatUsersIds,usersData:t.chatUsersData,firstUserData:t.firstUserData}})],1)],1)}),[],!1,null,"6e5e3469",null);e.default=component.exports;installComponents(component,{TextField:r(824).default})},824:function(t,e,r){"use strict";r.r(e);var n=r(100),l=(r(25),r(20),{props:{rules:{type:[Object],default:function(){return{}}},inputClass:{type:[String],default:""},topLabel:{type:[String],default:null},type:{type:[String],default:""},name:{type:[String],default:""},value:{type:[String,Array,Number,Boolean],default:null},suffix:{type:[String],default:""},prefix:{type:[String],default:""},filled:{type:[Boolean],default:!1},outlined:{type:[Boolean],default:!0},disabled:{type:[Boolean],default:!1},solo:{type:[Boolean],default:!1},appendIcon:{type:[String],default:""},backgroundColor:{type:[String],default:""},subLabel:{type:[String],default:""},supLabel:{type:[String],default:""},placeholder:{type:[String],default:""},label:{type:[String],default:""},isLoading:{type:[Boolean],default:!1},prependInnerIcon:{type:[String],default:""},vInputClass:{type:[String],default:""},errors:null},data:function(){return{initiatedAsPassword:!1,isReadOnly:!0}},computed:{isTypePassword:function(){return"password"===this.type},inputRules:function(){return this.disabled&&this.rules&&(this.rules.required=!1),this.rules},computedAppendIcon:function(){return this.initiatedAsPassword?("password"===this.type&&(t="fal fa-eye input-password"),"text"===this.type&&this.initiatedAsPassword&&(t="fal fa-eye-slash input-password"),t):this.appendIcon;var t}},created:function(){"password"===this.type&&(this.initiatedAsPassword=!0)},methods:{getRequiredStar:function(t){return this[t]&&this.rules&&this.rules.required?"".concat(this.$t(this[t])," *"):this.$t(this[t])},input:function(t){if("number"===this.type&&t)return this.$emit("update:value",parseInt(t));this.$emit("update:value",t),this.$emit("inputHandler",t)},enterClicked:function(){this.$emit("enterClicked")},click:function(){this.isTypePassword?(this.initiatedAsPassword=!0,this.$emit("update:type","text")):this.initiatedAsPassword&&this.$emit("update:type","password")}}}),o=r(44),component=Object(o.a)(l,(function(){var t=this,e=t._self._c;return e("ValidationProvider",{class:t.inputClass,attrs:{rules:t.rules,name:t.name},scopedSlots:t._u([{key:"default",fn:function(r){var l=r.errors;return[t.topLabel?e("label",{staticClass:"d-flex justify-space-between align-end mb-1 position-relative",staticStyle:{"font-size":"13px",color:"#ababab","font-weight":"500"}},[t._v("\n        "+t._s(t.getRequiredStar("topLabel"))+"\n\n    "),t._t("labelInner")],2):t._e(),t._v(" "),e(n.a,{staticClass:"mytexty-field",class:t.vInputClass,attrs:{value:t.value,"background-color":t.backgroundColor,readonly:!!t.isTypePassword&&t.isReadOnly,prefix:t.getRequiredStar("prefix"),suffix:t.$t(t.suffix),disabled:t.disabled,"append-icon":t.computedAppendIcon,"prepend-inner-icon":t.prependInnerIcon,"error-messages":l,"hide-details":"auto",dense:"",type:t.type,outlined:t.outlined,filled:t.filled,solo:t.solo,flat:"",placeholder:t.$t(t.placeholder),loading:t.isLoading},on:{"click:append":t.click,input:t.input,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enterClicked.apply(null,arguments)},focus:function(e){t.isReadOnly=!1}},scopedSlots:t._u([{key:"append",fn:function(){return[t._t("appendInner")]},proxy:!0},{key:"prepend-inner",fn:function(){return[t._t("prependInner")]},proxy:!0}],null,!0)})]}}],null,!0)})}),[],!1,null,"28abe298",null);e.default=component.exports},968:function(t,e,r){var content=r(1077);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(18).default)("06b33480",content,!0,{sourceMap:!1})}}]);